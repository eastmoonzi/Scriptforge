# GroupChat 用户手册 v3.3.0

**版本**: v3.3.0
**更新时间**: 2026-01-15
**适用人群**: 所有用户（从新手到高级用户）

---

## 📖 手册导航

- [第一部分：快速入门（5分钟上手）](#第一部分快速入门5分钟上手)
- [第二部分：基础功能](#第二部分基础功能)
- [第三部分：高级功能](#第三部分高级功能)
- [第四部分：实战案例](#第四部分实战案例)
- [第五部分：最佳实践](#第五部分最佳实践)
- [第六部分：故障排查](#第六部分故障排查)

---

## 第一部分：快速入门（5分钟上手）

### 🎯 什么是 GroupChat？

GroupChat 是一个创新的 AI 多智能体对话系统，让多个 AI 角色像真人一样进行自然对话。基于 **CrewAI 框架**实现了真正的多智能体架构，每个角色都是独立的 Agent，能够自主决策、协作互动。

**核心特点：**
- 🎭 真正的多智能体（CrewAI，而非简单的 Prompt 切换）
- 🧠 智能决策（Agent 自主判断是否需要发言）
- 💾 独立记忆（每个角色拥有完整记忆：群聊+私聊）
- 📱 友好界面（基于 Streamlit 的直观 Web UI）

---

### 🚀 第一次运行（5步完成）

#### 步骤 1：环境要求

- **Python**: >= 3.10
- **Gemini API Key**: 从 [Google AI Studio](https://ai.google.dev/) 免费获取

#### 步骤 2：安装依赖

```bash
# 克隆项目（如果还没有）
git clone https://github.com/yourusername/groupchat.git
cd groupchat

# 安装依赖
pip install -r requirements.txt
```

**主要依赖：**
- `streamlit>=1.52.2` - Web UI 框架
- `crewai>=1.7.2` - 多 Agent 框架
- `langchain-google-genai` - Gemini API 集成
- `chromadb` - RAG 向量数据库（可选）

#### 步骤 3：获取 API Key

1. 访问 [Google AI Studio](https://ai.google.dev/)
2. 点击 `Get API Key`
3. 创建新项目（或选择现有项目）
4. 复制 API Key（格式：`AIzaSy...`）

#### 步骤 4：启动应用

```bash
streamlit run app.py
```

浏览器会自动打开 `http://localhost:8501`

#### 步骤 5：创建第一个对话

1. **侧边栏** → 勾选 "使用真实 Gemini API"
2. 输入你的 API Key
3. **侧边栏** → 选择"导入预设"
4. 上传 `preset_example_castle.json`（古堡探险场景）
5. 点击 **"🎬 开始对话"**
6. 在输入框输入：`"大家好，我们准备好了吗？"`
7. 观察 AI 角色们的回应！

🎉 **恭喜！你已经成功运行了第一个多 Agent 对话！**

---

## 第二部分：基础功能

### 2.1 群聊模式

**功能说明：**
所有 AI 角色在同一个聊天室中互动，类似微信群聊。

**使用方法：**

1. 在主聊天区域输入消息
2. 点击"发送"或按 Enter
3. AI 角色们会根据对话内容决定是否发言

**特点：**
- ✅ Agent 自主决策（不是每个人都会回应）
- ✅ 发言顺序自然（不是固定轮流）
- ✅ 基于上下文智能回应

**示例对话：**
```
用户："这个计划怎么样？"

CrewAI 模式：
  勇士：很好！我支持这个计划
  （法师保持沉默）
  盗贼：我有些担心风险，但值得一试

传统模式（对比）：
  勇士：我觉得可以
  法师：我也觉得可以
  盗贼：我也觉得可以
  （机械、重复）
```

---

### 2.2 私聊模式

**功能说明：**
与单个 AI 角色进行一对一私密对话，其他角色不知道对话内容。

**使用方法：**

1. **侧边栏** → 展开"私聊管理"
2. 选择要私聊的角色
3. 点击"开始私聊"
4. 在弹出的对话框中输入消息

**私聊的价值：**

1. **传递秘密信息**：
   ```
   用户私聊法师："勇士害怕黑暗"

   回到群聊后：
   法师："这个山洞太黑了，我们点个火把吧，毕竟...有些人可能需要更多光亮。"
   （巧妙利用私聊信息，但没有直接泄露）
   ```

2. **获取独家情报**：
   ```
   用户私聊盗贼："你发现了什么线索？"
   盗贼："我刚才看到门上有机关，但我没告诉其他人。"
   ```

3. **建立角色关系**：
   ```
   用户私聊勇士："你觉得法师可靠吗？"
   勇士："说实话，我不太信任他，他总是犹豫不决。"
   ```

---

### 2.3 自主对话模式

**功能说明：**
让 AI 角色们自己互动，无需用户输入。

**使用方法：**

1. **侧边栏** → "🎭 自主对话控制"
2. 设置轮数（1-5轮）
3. 点击"🎭 继续聊"
4. 观察 Agent 自主互动

**应用场景：**

1. **观察角色互动**：
   - 让角色们自由讨论
   - 观察性格碰撞

2. **推进剧情**：
   - 你给出一个话题
   - 让角色们自己辩论

3. **测试角色设定**：
   - 看看角色是否符合人设
   - 检查对话质量

**注意事项：**
- 自主对话可能偏离主题（正常现象）
- 建议设置 2-3 轮即可
- 可随时通过用户输入重新引导

---

### 2.4 记忆系统

**功能说明：**
每个 Agent 拥有完整的对话记忆，包括群聊和私聊。

**记忆结构：**

```python
角色A的记忆 = [
    {"type": "group", "speaker": "用户", "content": "大家好"},
    {"type": "group", "speaker": "角色B", "content": "你好"},
    {"type": "private", "speaker": "用户", "content": "秘密信息"},  # 只有A知道
    {"type": "group", "speaker": "用户", "content": "继续讨论"},
]

角色B的记忆 = [
    {"type": "group", "speaker": "用户", "content": "大家好"},
    {"type": "group", "speaker": "角色B", "content": "你好"},
    # 没有角色A的私聊记录
    {"type": "group", "speaker": "用户", "content": "继续讨论"},
]
```

**查看记忆：**

1. **侧边栏** → 展开"🧠 角色记忆查看"
2. 选择要查看的角色
3. 点击"查看记忆"
4. 在弹出窗口中可以看到：
   - 群聊记录（绿色）
   - 私聊记录（蓝色）

**清空记忆：**

- **侧边栏** → "记忆管理" → "清空所有记忆"
- 清空后角色会"失忆"，对话从零开始

---

### 2.5 预设管理

**功能说明：**
快速加载预配置的场景和角色。

**使用内置预设：**

1. **侧边栏** → "导入预设"
2. 上传预设文件：
   - `preset_example_castle.json` - 古堡探险（悬疑）
   - `preset_example_startup.json` - 创业公司（商业）
   - `preset_example_xiuxian.json` - 修仙世界（玄幻）

**创建自定义预设：**

1. 手动配置场景和角色
2. **侧边栏** → "导出预设"
3. 保存为 `.json` 文件
4. 下次可以快速导入

**预设文件格式：**

```json
{
  "scene": "场景描述",
  "characters": [
    {
      "name": "角色名",
      "personality": "性格描述"
    }
  ],
  "user_character": {
    "name": "你",
    "personality": ""
  }
}
```

---

### 2.6 对话导出/导入

**导出对话：**

1. **侧边栏** → "对话历史管理"
2. 点击"导出对话"
3. 保存为 JSON 文件

**导入对话：**

1. **侧边栏** → "对话历史管理"
2. 上传之前导出的对话文件
3. 对话历史会被加载

**用途：**
- 保存精彩对话
- 继续之前的对话
- 分享给朋友

---

## 第三部分：高级功能

### 3.1 CrewAI 多 Agent 模式

**功能说明：**
使用 CrewAI 框架实现真正的多智能体协作。

**启用方式：**

1. **侧边栏** → 勾选 "🤖 启用 CrewAI 多 Agent 系统"
2. （默认已启用）

**CrewAI vs 传统模式：**

| 特性 | 传统模式 | CrewAI 模式 |
|------|---------|------------|
| 架构 | 单个 LLM + 切换 Prompt | 多个 Agent 独立决策 |
| 发言机制 | 强制轮流 | 自主选择（可以 PASS） |
| 记忆 | 共享 | 独立（每个 Agent 有自己的记忆） |
| 协作 | 模拟 | 真实（Agent 间通信） |

**自主决策示例：**

```python
# Agent 内部思考：
# 1. 用户刚才说了什么？
# 2. 我是否需要回应？
# 3. 如果回应，说什么？
# 4. 如果不合适，输出 PASS

输出示例：
- "我同意这个方案" ← 发言
- "PASS" ← 沉默
```

**降级机制：**

如果 CrewAI 初始化失败，系统会自动降级到传统模式：
```
⚠️  CrewAI 初始化失败，已降级为传统模式
原因：API Key 无效 / 网络问题
```

---

### 3.2 RAG 记忆检索

**功能说明：**
使用 RAG（检索增强生成）技术，让 AI 能够从历史对话中检索相关信息。

**启用方式：**

1. **侧边栏** → 勾选 "🧠 启用 RAG 记忆检索"
2. 系统会自动初始化向量数据库

**工作原理：**

```
用户输入："还记得我们之前讨论的宝藏位置吗？"
      ↓
RAG 系统检索历史对话
      ↓
找到相关记忆："宝藏在地下室的第三个柜子里"
      ↓
Agent 基于检索结果回答："当然记得，宝藏在地下室的第三个柜子里。"
```

**检索策略：**

1. **关键词检索**：快速定位包含特定词汇的对话
2. **语义检索**：理解语义相似的对话
3. **混合检索**：结合上述两种方式（默认）

**查看检索结果：**

- **侧边栏** → "RAG 检索结果"
- 显示最相关的历史对话

**适用场景：**

- 长对话（>50 条消息）
- 需要回溯历史信息
- 复杂剧情（多条线索）

**注意事项：**

- 首次初始化需要时间（10-30秒）
- 需要安装 `chromadb` 依赖
- 向量数据库存储在 `./chroma_db/` 目录

---

### 3.3 Few-shot 剧本模版

**功能说明：**
使用专业话剧风格模版，提升对话质量。

**启用方式：**

1. **侧边栏** → "📚 Few-shot 剧本模版"
2. 勾选 "启用剧本模版"
3. 选择风格：
   - **悬疑话剧风格** - 适合推理、侦探、悬疑场景
   - **喜剧话剧风格** - 适合轻松、幽默、搞笑场景
   - **现实主义话剧风格** - 适合现实题材、社会议题

**模版效果对比：**

**无模版：**
```
法师：这里有个门。
勇士：我们开门吗？
盗贼：好的，开门吧。
```

**悬疑模版：**
```
法师：等等，你们注意到门框上的符文了吗？这不是普通的门...
勇士：管那么多干什么！宝藏就在里面！
盗贼：我闻到了陷阱的味道，这扇门...有蹊跷。
```

**模版包含：**

1. **语言特征**：
   - 推荐词汇（如悬疑："线索"、"疑点"、"破绽"）
   - 句式参考（如悬疑："这件事有蹊跷..."）
   - 语气风格（如悬疑："谨慎、试探、暗示"）

2. **Few-shot 示例**：
   - 完整的多轮对话示例
   - 展示角色互动技巧
   - 附带分析说明

3. **反面示例**：
   - 展示不好的写法
   - 说明问题所在
   - 提供改进方案

**自定义模版：**

1. 参考 `templates/` 目录下的 JSON 文件
2. 创建自己的模版文件
3. 放入 `templates/` 目录
4. 重启应用后自动加载

---

### 3.4 评测体系

**功能说明：**
量化评估对话质量，提供三大核心指标。

**运行评测：**

```bash
# 基础评测（无 OOC 检测）
python run_evaluation.py

# 完整评测（包含 OOC）
python run_evaluation.py --api-key YOUR_GEMINI_KEY

# 自定义数据集
python run_evaluation.py --dataset custom_dataset.json
```

**三大核心指标：**

#### 1. CPD - 人设离散度（Character Personality Divergence）

**定义**：衡量不同角色发言的差异程度

**计算方法**：
```
CPD = 词汇多样性(50%) + 长度差异(30%) + 标点风格(20%)
```

**评分标准**：
- `>80`：优秀 - 角色性格非常鲜明
- `60-80`：良好 - 角色有一定区分度
- `40-60`：中等 - 角色略有区分但不够明显
- `<40`：较差 - 角色趋同，缺乏个性

#### 2. DE - 对话有效率（Dialogue Efficiency）

**定义**：衡量对话中有效信息的密度

**计算方法**：
```
DE = 信息密度(40%) + (1-重复率)(30%) + (1-无意义率)(30%)
```

**评分标准**：
- `>85`：优秀 - 信息密集，无冗余
- `70-85`：良好 - 信息充足，少量重复
- `50-70`：中等 - 有一定冗余
- `<50`：较差 - 大量重复或无效对话

#### 3. OOC 率（Out of Character Rate）

**定义**：角色发言不符合人设的比例

**检测方法**：
- 使用 LLM 检测发言是否符合人设
- 对每个角色采样检测（最多5条/角色）

**评分标准**：
- `<5%`：优秀 - 角色几乎不出戏
- `5-15%`：良好 - 偶尔出戏
- `15-30%`：中等 - 经常出戏
- `>30%`：较差 - 严重出戏

**查看评测报告：**

评测报告保存在 `evaluation_reports/` 目录：
- `detailed_results_YYYYMMDD_HHMMSS.json` - 详细结果
- `summary_YYYYMMDD_HHMMSS.json` - 汇总报告

---

### 3.5 导演系统（实验性）

**功能说明：**
引入管理层 Agent（编剧、导演、审核），提升对话质量。

**架构：**

```
用户输入
   ↓
编剧规划（剧情目标）
   ↓
导演分配（角色任务）
   ↓
角色表演（生成对话）
   ↓
审核检查（质量把关）
   ↓
输出对话（或重试）
```

**使用方式：**

目前导演系统是独立的实验性功能，需要运行：

```bash
python director_system.py
```

**未来计划：**

- 集成到 `app.py` 作为可选模式
- 添加 UI 控制开关
- 优化响应速度

**详细文档：**

参见 [DIRECTOR_SYSTEM_GUIDE.md](DIRECTOR_SYSTEM_GUIDE.md)

---

## 第四部分：实战案例

### 案例 1：悬疑话剧 - 古堡探险

**场景设定：**
```
场景：深夜，三位冒险者在古堡中寻找宝藏

角色：
- 勇士（性格：勇敢、冲动、直率）
- 法师（性格：聪明、谨慎、理性）
- 盗贼（性格：狡猾、机智、谨慎）
```

**推荐配置：**
- ✅ 启用 CrewAI 模式
- ✅ 启用 Few-shot 模版（悬疑风格）
- ✅ 启用 RAG（如果对话较长）

**对话示例：**

```
用户："前面有一扇门，我们该怎么办？"

勇士："管那么多干什么！我们来就是找宝藏的，开门就完了！"

法师："等等，勇士！这扇门看起来不对劲，我感觉到了魔法波动..."

盗贼："法师说得对，你们看这里——门框上有细小的符文，这是陷阱机关！"

用户（私聊盗贼）："你能解开机关吗？"

盗贼（私聊）："可以，但需要时间。我建议先不告诉勇士，他太冲动了。"

用户："那我们现在怎么办？"

盗贼："我需要仔细研究一下这些符文...大家先别轻举妄动。"
（巧妙利用私聊信息，没有直接说出来）
```

**技巧：**
1. 使用私聊传递秘密
2. 观察角色如何利用私密信息
3. 让 Agent 自主对话推进剧情

---

### 案例 2：商业场景 - 创业公司会议

**场景设定：**
```
场景：创业公司办公室，三位创始人讨论新产品方向

角色：
- CEO（性格：果断、激进、有魅力）
- CTO（性格：技术导向、保守、注重细节）
- COO（性格：务实、平衡、善于协调）
```

**推荐配置：**
- ✅ 启用 CrewAI 模式
- ✅ 启用 Few-shot 模版（现实主义风格）
- ❌ 不启用 RAG（会议对话较短）

**对话示例：**

```
用户："我们要不要进入 AI 市场？"

CEO："这是个巨大的机会！AI 市场正在爆发，我们必须抓住这波红利！"

CTO（保持沉默，思考中）

COO："我同意这是机会，但我们需要考虑成本和风险。我们的技术储备够吗？"

CEO："技术可以招人，市场机会稍纵即逝！"

CTO："我有不同看法。AI 技术门槛很高，如果我们仓促进入，产品质量会有问题。"

COO："那我们不如先做小规模试点？测试市场反应？"
```

**观察点：**
- CEO 的激进 vs CTO 的保守
- COO 的协调作用
- 自然的观点碰撞

---

### 案例 3：创意写作 - 剧本创作讨论

**场景设定：**
```
场景：编剧工作室，三位编剧讨论新剧本

角色：
- 老编剧（性格：经验丰富、注重结构、传统）
- 年轻编剧（性格：创新、大胆、天马行空）
- 制片人（性格：商业导向、注重市场、实际）
```

**推荐配置：**
- ✅ 启用 CrewAI 模式
- ✅ 启用 Few-shot 模版（喜剧或现实主义）
- ✅ 使用自主对话功能

**对话示例：**

```
用户："主角应该是什么样的人？"

年轻编剧："我觉得主角应该是个有超能力的黑客，能入侵所有系统！"

老编剧："太浮夸了。好的角色需要真实感，超能力会让观众无法共情。"

制片人："我同意老师的观点。市场调研显示，观众更喜欢接地气的角色。"

（设置自主对话 2 轮）

年轻编剧："那如果主角只是个普通程序员，但通过努力成长呢？"

老编剧："这就对了！成长型角色才有戏剧张力。"

制片人："而且可以加入职场元素，吸引更多观众。"
```

**技巧：**
1. 初始给出话题
2. 使用自主对话让角色讨论
3. 适时介入引导方向

---

## 第五部分：最佳实践

### 5.1 如何设计角色人设

**基本原则：**

1. **具体化，避免模糊**

❌ 不好：
```
角色：好人
性格：善良
```

✅ 好：
```
角色：退休警探
性格：正义感强、细心观察、不信任他人、固执己见
```

2. **对比性，制造冲突**

设计3个角色时，至少要有一对对立关系：

```
角色A：冲动、激进、乐观
角色B：谨慎、保守、悲观  ← 与A形成对比
角色C：中立、理性、协调   ← 平衡者
```

3. **复杂性，避免脸谱化**

❌ 单一性格：
```
勇士：勇敢
```

✅ 多维性格：
```
勇士：勇敢但冲动、重视荣誉但不善言辞、外表粗犷内心细腻
```

**角色设计模板：**

```
角色名：[名字]
核心特质：[主要性格，2-3个词]
行为模式：[如何做决策、如何说话]
优点：[1-2个]
缺点：[1-2个]
知识背景：[专业领域]
说话风格：[语气、常用词汇]
```

**示例：**

```
角色名：老探长
核心特质：经验丰富、细心、不苟言笑
行为模式：先观察再发言、从细节推理、质疑他人观点
优点：观察力强、逻辑严密
缺点：固执、不信任年轻人
知识背景：刑侦、心理学
说话风格：简洁、常用"注意到..."、"这说明..."
```

---

### 5.2 如何使用记忆系统

**记忆系统的三个层次：**

#### 层次 1：基础使用

直接对话，系统自动记录：

```
用户："今天天气不错"
角色A："是啊，很适合外出"
（自动记录到记忆）
```

#### 层次 2：私聊策略

利用私聊传递秘密：

```
私聊角色A："其实我怀疑角色B"
↓
回到群聊
↓
角色A会巧妙利用这个信息，但不直接说出来
```

#### 层次 3：长对话管理

对于超过 50 条消息的长对话：

1. **启用 RAG**：自动检索相关历史
2. **定期导出**：保存重要对话
3. **适时清空**：开启新章节时清空记忆

**最佳实践：**

1. **分章节管理**
   ```
   第一章：古堡探险 → 完成后导出 → 清空记忆
   第二章：地下迷宫 → 重新开始
   ```

2. **关键信息强调**
   ```
   用户："记住，宝藏的密码是 1234"
   用户："再说一遍，密码是 1234"  ← 重复强化
   ```

3. **定期回顾**
   ```
   用户："我们之前讨论的三个线索是什么？"
   （让 Agent 回忆，检查记忆）
   ```

---

### 5.3 如何优化对话质量

**质量问题 → 解决方案：**

#### 问题 1：角色说话都一样（角色趋同）

**解决方案：**
1. ✅ 强化人设对比（见 5.1）
2. ✅ 启用 Few-shot 模版
3. ✅ 使用评测体系检查 CPD 指标

**示例：**

改进前：
```
勇士："我觉得可以试试"
法师："我也觉得可以试试"
盗贼："我也觉得可以试试"
```

改进后（强化人设）：
```
勇士："试什么试！直接干就完了！"
法师："等等，我们需要仔细分析一下风险..."
盗贼："我闻到了危险的味道，但富贵险中求。"
```

#### 问题 2：对话重复、无效

**解决方案：**
1. ✅ 避免过于宽泛的问题
2. ✅ 使用具体场景
3. ✅ 启用 CrewAI 模式（允许沉默）

**示例：**

❌ 宽泛问题：
```
用户："大家觉得怎么样？"
（角色无话可说，只能客套）
```

✅ 具体场景：
```
用户："门上有三个按钮：红、蓝、绿，按错了会触发陷阱，你们觉得按哪个？"
（有具体问题，角色可以分析）
```

#### 问题 3：角色出戏（OOC）

**解决方案：**
1. ✅ 人设中明确知识范围
2. ✅ 使用评测体系检测 OOC
3. ✅ 定期检查对话质量

**示例：**

❌ 出戏：
```
角色：中世纪骑士
发言："我用手机查一下地图"  ← 中世纪没有手机
```

✅ 不出戏：
```
人设中明确：中世纪骑士，不了解现代科技
发言："我们需要找个向导，或者查看星象判断方位"
```

---

### 5.4 如何选择合适的模版

**三种模版的适用场景：**

#### 1. 悬疑话剧风格

**适合：**
- 推理、侦探、谋杀案
- 需要制造悬念
- 信息层层递进

**不适合：**
- 轻松搞笑场景
- 日常生活对话

**推荐词汇：**
线索、疑点、破绽、真相、蹊跷

**示例句式：**
"这件事有蹊跷..."、"我注意到一个细节..."

---

#### 2. 喜剧话剧风格

**适合：**
- 轻松、幽默、搞笑
- 夸张表现
- 矛盾冲突

**不适合：**
- 严肃题材
- 悲剧场景

**推荐词汇：**
夸张、闹剧、误会、巧合

**示例句式：**
"你说什么？！"、"这不可能！"

---

#### 3. 现实主义话剧风格

**适合：**
- 现实题材
- 社会议题
- 情感克制

**不适合：**
- 玄幻、科幻
- 需要夸张表现的场景

**推荐词汇：**
真实、克制、反思

**示例句式：**
"我只是..."、"其实..."

---

**混合使用：**

你也可以根据剧情发展切换模版：

```
第一幕：悬疑模版（制造紧张感）
第二幕：喜剧模版（缓解紧张）
第三幕：现实主义模版（深度思考）
```

---

## 第六部分：故障排查

### 6.1 常见问题速查

#### Q1：应用无法启动

**症状：**
```
ModuleNotFoundError: No module named 'streamlit'
```

**解决方案：**
```bash
pip install -r requirements.txt
```

---

#### Q2：CrewAI 模式不可用

**症状：**
```
⚠️  CrewAI 初始化失败，已降级为传统模式
```

**可能原因：**
1. API Key 无效
2. 网络问题
3. 依赖缺失

**解决方案：**
```bash
# 1. 检查 API Key
# 确保格式正确：AIzaSy...

# 2. 检查网络
ping google.com

# 3. 重新安装 crewai
pip install --upgrade crewai
```

---

#### Q3：API 调用失败

**症状：**
```
Error: API request failed
```

**解决方案：**

1. **检查 API Key 是否有效**
   - 访问 [Google AI Studio](https://ai.google.dev/)
   - 生成新的 API Key

2. **检查配额**
   - 免费版有调用限制
   - 查看 [配额说明](https://ai.google.dev/pricing)

3. **更换模型**
   - 侧边栏 → 选择其他模型
   - 推荐：`gemini-1.5-flash`（更稳定）

---

#### Q4：RAG 初始化失败

**症状：**
```
Error initializing RAG: chromadb not installed
```

**解决方案：**
```bash
pip install chromadb
```

如果还是失败：
```bash
pip install --upgrade chromadb langchain-chroma sentence-transformers
```

---

#### Q5：角色不发言

**症状：**
- 勾选"继续聊"后无反应
- 所有角色都输出 "PASS"

**可能原因：**
1. 场景/角色描述过于模糊
2. 对话缺少具体话题
3. 所有角色判断不需要发言

**解决方案：**

1. **提供具体场景**
   ```
   ❌ 场景："讨论"
   ✅ 场景："在密室中发现了三个按钮，需要决定按哪个"
   ```

2. **提出明确问题**
   ```
   ❌ "大家觉得怎么样？"
   ✅ "红色按钮和蓝色按钮，你们建议按哪个？"
   ```

3. **关闭 CrewAI 模式**（临时方案）
   - 传统模式会强制所有角色发言

---

#### Q6：对话质量差

**症状：**
- 角色说话都一样
- 对话重复无意义
- 角色出戏（OOC）

**解决方案：**

1. **运行评测体系**
   ```bash
   python run_evaluation.py --api-key YOUR_KEY
   ```
   查看 CPD、DE、OOC 指标

2. **强化角色人设**（见 5.1）

3. **启用 Few-shot 模版**（见 3.3）

4. **查看 Bad Case 库**
   ```bash
   cat bad_case_library.json
   ```
   学习常见问题和解决方案

---

### 6.2 错误代码对照

| 错误代码 | 含义 | 解决方案 |
|---------|------|---------|
| `API_KEY_INVALID` | API Key 无效 | 检查 Key 格式，重新生成 |
| `QUOTA_EXCEEDED` | 配额超限 | 等待配额重置或升级账户 |
| `NETWORK_ERROR` | 网络错误 | 检查网络连接 |
| `MODEL_NOT_FOUND` | 模型不存在 | 更换其他模型 |
| `CREWAI_INIT_FAILED` | CrewAI 初始化失败 | 检查依赖，查看日志 |
| `RAG_INIT_FAILED` | RAG 初始化失败 | 安装 chromadb |

---

### 6.3 日志查看方法

**Streamlit 日志：**

日志会直接显示在终端：

```bash
streamlit run app.py
# 日志会实时输出
```

**保存日志到文件：**

```bash
streamlit run app.py 2>&1 | tee app.log
```

**查看详细日志：**

在 `app.py` 中启用详细日志：

```python
# 找到这一行
verbose = False

# 改为
verbose = True
```

---

### 6.4 上报问题

如果以上方法都无法解决，请提交 Issue：

1. 访问 [GitHub Issues](https://github.com/yourusername/groupchat/issues)
2. 点击 "New Issue"
3. 提供以下信息：
   - 问题描述
   - 复现步骤
   - 错误日志
   - 环境信息（Python 版本、操作系统）

---

## 📚 进阶阅读

- [API.md](API.md) - API 文档和技术细节
- [CREWAI_GUIDE.md](CREWAI_GUIDE.md) - CrewAI 架构深度解析
- [EVALUATION_SYSTEM_GUIDE.md](EVALUATION_SYSTEM_GUIDE.md) - 评测体系完整指南
- [RAG_GUIDE.md](RAG_GUIDE.md) - RAG 系统深度指南
- [prompt.md](prompt.md) - Prompt 设计三层架构
- [DIRECTOR_SYSTEM_GUIDE.md](DIRECTOR_SYSTEM_GUIDE.md) - 导演系统使用指南
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - 完整故障排查指南

---

## 📞 获取帮助

- **文档中心**：[DOCS.md](DOCS.md)
- **GitHub Issues**：[提交问题](https://github.com/yourusername/groupchat/issues)
- **讨论区**：[GitHub Discussions](https://github.com/yourusername/groupchat/discussions)

---

**祝你使用愉快！🎉**
