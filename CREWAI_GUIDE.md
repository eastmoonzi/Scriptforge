# CrewAI 多 Agent 系统使用指南

## 🎉 v3.0.0 重大架构升级

本版本是架构级别的重大升级，集成了 **CrewAI 框架**，实现了真正的多智能体（Multi-Agent）对话系统！

---

## 🆚 两种模式对比

### CrewAI 多 Agent 模式 ⭐ 推荐

**特点：**
- ✅ 每个角色是独立的 Agent
- ✅ Agent 自主决定是否发言
- ✅ 真正的协作和协商机制
- ✅ 基于完整记忆（群聊+私聊）做决策
- ✅ 更智能、更自然的对话

**适用场景：**
- 需要真实的角色互动
- 希望角色有自主性
- 面试作品集展示（体现技术深度）

### 传统顺序模式

**特点：**
- 角色按固定顺序发言
- 每个角色都会发言
- 简单、可预测

**适用场景：**
- 需要每个角色都参与
- 对话需要完全可控
- API 调用成本考虑

---

## 🚀 快速开始

### 1. 环境要求

```bash
# Python 版本
Python >= 3.10

# 安装依赖
pip install crewai langchain-google-genai streamlit
```

### 2. 运行应用

```bash
streamlit run app.py
```

### 3. 配置选项

#### 侧边栏设置：

1. **导入预设**（可选）
   - 上传 JSON 预设文件
   - 或手动配置场景和角色

2. **Gemini API**
   - ☑️ 勾选"使用真实 Gemini API"
   - 输入 API Key

3. **CrewAI 开关**
   - ☑️ 勾选"🤖 启用 CrewAI 多 Agent 系统"（推荐）
   - 或取消勾选使用传统模式

4. **对话模式**
   - 选择"群聊模式"或"私聊模式"

---

## 🎭 CrewAI 工作原理

### 架构图

```
用户输入
    ↓
CrewAI Crew（团队）
    ↓
并发执行所有 Agent 任务
    ├─ Agent A 决策：要不要说话？
    ├─ Agent B 决策：要不要说话？
    └─ Agent C 决策：要不要说话？
    ↓
想发言的 Agent 生成内容
    ↓
按顺序输出结果
```

### 核心特性

#### 1. Agent 自主决策

每个 Agent 会根据：
- 当前对话上下文
- 自己的性格特点
- 完整记忆（包含私聊）
- 是否被提及

来决定**是否发言**和**说什么**

#### 2. 独立记忆系统

```python
角色 A 的记忆 = [
    群聊消息1,
    群聊消息2,
    私聊A消息1,  # 只有 A 知道
    群聊消息3,
    ...
]

角色 B 的记忆 = [
    群聊消息1,
    群聊消息2,
    群聊消息3,   # 不知道 A 的私聊
    私聊B消息1,  # 只有 B 知道
    ...
]
```

#### 3. 智能对话流程

**示例场景：**

```
用户："谁想听个秘密？"

CrewAI 执行：
  - Agent A: "我想！我很好奇！" （发言）
  - Agent B: PASS （保持沉默）
  - Agent C: "说来听听" （发言）

结果：只有 A 和 C 回应，B 选择沉默
```

---

## 🔧 高级功能

### 1. 自主对话

**功能：** 让角色们自己聊天，无需用户介入

**使用方法：**
1. 设置轮数（1-5轮）
2. 点击"🎭 继续聊"
3. 观察角色们的自主互动

**CrewAI 优势：**
- 不是每个角色都会发言
- 发言顺序不固定
- 对话更自然

### 2. 私聊记忆融合

**场景演示：**

```
1. 群聊："这个计划怎么样？"
2. 私聊 Agent A："其实我反对这个计划"
3. 回到群聊

CrewAI 模式下：
- Agent A 会基于私聊信息，在群聊中巧妙暗示反对意见
- 但不会直接泄露"我在私聊说了什么"
```

### 3. 降级机制

**自动降级：**
- CrewAI 执行失败时自动降级到传统模式
- 保证服务可用性

**手动切换：**
- 取消勾选"启用 CrewAI"即可切换

---

## 💡 面试展示要点

### 技术亮点

1. **框架选型能力**
   > "我对比了 LangChain、AutoGen 和 CrewAI，选择 CrewAI 是因为它专为角色化 Agent 团队设计，与产品定位完美契合"

2. **架构设计**
   > "实现了真正的多 Agent 系统，每个角色有独立记忆和决策能力，支持信息不对称"

3. **工程实践**
   > "设计了降级机制，CrewAI 失败时自动切换到传统模式，保证可用性"

4. **产品思维**
   > "CrewAI 代表了 AI 从单点工具向协作团队演进的趋势"

### 演示脚本

**场景：古堡探险**

1. **初始化：** 导入"古堡探险"预设
2. **群聊互动：** 用户说"我们该往哪走？"
   - 展示：多个 Agent 自主决定是否回应
3. **私聊秘密：** 私聊法师"其实我知道陷阱在哪"
4. **信息利用：** 回到群聊，观察法师如何利用私密信息
5. **自主对话：** 点击"继续聊"，展示 Agent 自主协作

---

## 📊 性能对比

| 维度 | 传统模式 | CrewAI 模式 |
|------|---------|------------|
| Agent 数量 | 伪 Agent | 真 Agent |
| 决策能力 | 被动发言 | 主动决策 |
| 对话自然度 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| API 调用次数 | N个角色 | 可能少于N（有些不发言） |
| 技术深度 | ⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 🐛 故障排除

### 问题：CrewAI 不可用

**检查：**
```bash
python3 --version  # 需要 >= 3.10
pip list | grep crewai
```

**解决：**
```bash
pip install --upgrade crewai langchain-google-genai
```

### 问题：Agent 不发言

**原因：**
- Agent 决定保持沉默是正常的
- 这是 CrewAI 的智能特性

**解决：**
- 提供更明确的对话引导
- 或切换到传统模式（保证每个角色都发言）

### 问题：API 调用失败

**降级：**
- 系统会自动降级到传统模式
- 检查 API Key 是否正确
- 查看错误提示

---

## 📚 相关资源

- **CrewAI 官方文档：** https://docs.crewai.com/
- **Gemini API：** https://ai.google.dev/
- **项目 GitHub：** （填入你的项目链接）

---

## 🎯 下一步

### 建议改进方向

1. **更智能的决策**
   - 基于对话情绪判断是否发言
   - 考虑角色关系网络

2. **Agent 工具调用**
   - 让 Agent 可以查询知识库
   - 执行特定技能（如法师施法、盗贼开锁）

3. **多轮协商**
   - Agent 间可以辩论
   - 达成共识后再输出

---

**享受真正的多 Agent 对话体验！** 🚀
